<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:medi1.SplashPageComponents"
    x:Class="medi1.Pages.HomePage"
    Title="Dashboard">

  <!-- Converter to highlight the current day -->
  <ContentPage.Resources>
    <ResourceDictionary>
      <components:HighlightToday x:Key="HighlightToday"/>
    </ResourceDictionary>
  </ContentPage.Resources>

  <ScrollView>
    <StackLayout Padding="20">

      <!-- Month Navigation -->
      <FlexLayout Direction="Row" HorizontalOptions="Center">
        <Button Text="◀" Clicked="OnPrevMonthClicked" Margin="0,5,10,0"/>
        <Label Text="{Binding CurrentMonth}" FontSize="24" HorizontalOptions="Center" Margin="0,5,0,0"/>
        <Button Text="▶" Clicked="OnNextMonthClicked" Margin="10,5,0,0"/>
      </FlexLayout>

      <!-- Weekday Headers -->
      <Grid HorizontalOptions="Center" ColumnSpacing="130" Margin="0,30,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Label Text="Sunday"    Grid.Column="0" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Monday"    Grid.Column="1" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Tuesday"   Grid.Column="2" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Wednesday" Grid.Column="3" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Thursday"  Grid.Column="4" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Friday"    Grid.Column="5" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
        <Label Text="Saturday"  Grid.Column="6" HorizontalOptions="Center" FontAttributes="Bold" FontSize="18"/>
      </Grid>

      <!-- Calendar Display -->
<Grid HorizontalOptions="FillAndExpand" VerticalOptions="Center" Padding="20, 30" Margin="0,-20,0,0">
  <CollectionView ItemsSource="{Binding DaysInMonth}" HorizontalOptions="FillAndExpand" VerticalOptions="Center">
    <CollectionView.ItemsLayout>
      <!-- Still 7 columns -->
      <GridItemsLayout Orientation="Vertical" Span="7"/>
    </CollectionView.ItemsLayout>
    <CollectionView.ItemTemplate>
      <DataTemplate>
        <Frame
            Padding="5"
            Margin="2"
            CornerRadius="5"
            HeightRequest="100"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="FillAndExpand"
            BackgroundColor="{Binding IsToday, Converter={StaticResource HighlightToday}}">
          
          <!-- Number in top-left -->
          <Label
              Text="{Binding DayNumber}"
              HorizontalOptions="Start"
              VerticalOptions="Start"
              Margin="5"
              FontSize="18"
              FontAttributes="Bold">
            <Label.Triggers>
              <!-- Hide placeholder cells -->
              <DataTrigger TargetType="Label"
                           Binding="{Binding DayNumber}"
                           Value="0">
                <Setter Property="Text" Value="" />
              </DataTrigger>
            </Label.Triggers>
          </Label>
        </Frame>
      </DataTemplate>
    </CollectionView.ItemTemplate>
  </CollectionView>
</Grid>

<BoxView HeightRequest="1" Color="LightGray" HorizontalOptions="FillAndExpand" Margin="0,10,0,10"/>


      <!-- Condition Filter Section -->
      <Label Text="↓  List of Conditions:" FontSize="20" Margin="0,10,0,5"/>
      <CollectionView x:Name="conditionsCollectionView"
                      ItemsSource="{Binding Conditions}">
        <CollectionView.ItemsLayout>
          <LinearItemsLayout Orientation="Horizontal"/>
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <StackLayout Orientation="Horizontal" Padding="5">
              <StackLayout.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnConditionTapped"/>
              </StackLayout.GestureRecognizers>
              <BoxView WidthRequest="10"
                       HeightRequest="10"
                       Color="{Binding Color}"
                       CornerRadius="5"
                       VerticalOptions="Center"/>
              <Label Text="{Binding Name}" VerticalOptions="Center" Margin="10,0,0,0"/>
            </StackLayout>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

      <!-- Navigation Buttons -->
      <FlexLayout Direction="Row" JustifyContent="Center" AlignItems="Center" Padding="30">
        <Button Text="My Conditions"
                BackgroundColor="Red"
                TextColor="White"
                FontSize="14"
                WidthRequest="120"
                HeightRequest="40"
                Clicked="GoToConditions"
                Margin="5,10,0,0"/>
        <Button Text="Log Entry"
                BackgroundColor="LightGray"
                TextColor="Red"
                FontSize="14"
                WidthRequest="120"
                HeightRequest="40"
                Clicked="GoToAddEntry"
                Margin="5,10,0,0"/>
        <Button Text="Reports"
                BackgroundColor="Blue"
                TextColor="White"
                FontSize="14"
                WidthRequest="120"
                HeightRequest="40"
                Clicked="GoToReports"
                Margin="5,10,0,0"/>
      </FlexLayout>

      <!-- Today's Date, Tasks & Events -->
      <Frame BorderColor="Gray" Padding="20" CornerRadius="10" HasShadow="True" BackgroundColor="Transparent" Margin="0,30,0,0">
        <StackLayout Orientation="Vertical" Spacing="10">
          <Label Text="{Binding FullDateToday}" FontSize="24" HorizontalOptions="Center"/>

          <!-- Pane for Adding New Tasks -->
          <Frame Margin="0,-40,0,0">
            <StackLayout>
              <Label Text="Today's Tasks" FontSize="20" HorizontalOptions="Center" Padding="20" Margin="0,-5,0,0"/>
              <Button Text="+ New Task" Clicked="OnAddTaskClicked"/>

              <!-- Where task items get injected -->
              <StackLayout x:Name="TaskListContainer" Padding="10" Spacing="5"/>

              <!-- Add Task Popup -->
              <Grid x:Name="AddTaskPopup"
                    BackgroundColor="Black"
                    Opacity="0.5"
                    IsVisible="False"
                    HorizontalOptions="Center"
                    VerticalOptions="CenterAndExpand">
                <Frame BackgroundColor="White"
                       Padding="20"
                       CornerRadius="10"
                       HasShadow="True">
                  <StackLayout>
                    <Label Text="Add Task" FontSize="18" HorizontalOptions="Center"/>
                    <Entry x:Name="TaskInput" Placeholder="New Task..."/>
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="10">
                      <Button Text="Confirm" Clicked="OnConfirmTaskClicked"/>
                      <Button Text="Cancel"  Clicked="OnCancelTaskClicked"/>
                    </StackLayout>
                  </StackLayout>
                </Frame>
              </Grid>

              <!-- Edit Task Popup -->
              <Grid x:Name="EditTaskPopup"
                    BackgroundColor="Black"
                    Opacity="0.5"
                    IsVisible="False"
                    HorizontalOptions="Center"
                    VerticalOptions="CenterAndExpand">
                <Frame BackgroundColor="White"
                       Padding="20"
                       CornerRadius="10"
                       HasShadow="True">
                  <StackLayout>
                    <Label Text="Edit Task" FontSize="18" HorizontalOptions="Center"/>
                    <Entry x:Name="EditTaskInput" Placeholder="Edit Task..."/>
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="10">
                      <Button Text="Confirm" Clicked="TaskEditConfirmClicked"/>
                      <Button Text="Cancel"  Clicked="TaskEditCancelClicked"/>
                    </StackLayout>
                  </StackLayout>
                </Frame>
              </Grid>
            </StackLayout>
          </Frame>

          <!-- Pane for Viewing Today's Entries -->
          <Frame>
            <Label Text="Health Events" FontSize="20" HorizontalOptions="Center"/>
          </Frame>

          <!-- Events Section -->
          <Frame>
            <StackLayout>
              <Label Text="Activities" FontSize="20" HorizontalOptions="Center"/>
              <!-- (Hook up your CalendarPage events here) -->
            </StackLayout>
          </Frame>
        </StackLayout>
      </Frame>
    </StackLayout>
  </ScrollView>
</ContentPage>